<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Questions Viewer</title>
    <link rel="shortcut icon" href="favicon.png" type="image/x-icon" />
    <link rel="stylesheet" href="styles.css" />
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <link href="image-zoom/zoom.css" rel="stylesheet" />
  </head>

  <body>
    <!-- Add user info display -->
    <div class="user-info" id="userInfo" style="display: none">
      <span id="userEmail"></span>
      <button class="logout-button" id="logoutButton">Logout</button>
    </div>

    <!-- Add auth container (initially hidden) -->
    <div class="auth-container" id="authContainer" style="display: none">
      <div class="auth-box">
        <div class="auth-title" id="authTitle">Login</div>
        <div class="auth-error" id="authError"></div>
        <form class="auth-form" id="authForm">
          <input
            type="email"
            id="authEmail"
            class="auth-input"
            placeholder="Email"
            required
          />
          <input
            type="password"
            id="authPassword"
            class="auth-input"
            placeholder="Password"
            required
          />
          <button type="submit" class="auth-button" id="authSubmit">
            Login
          </button>
          <div class="auth-switch" id="authSwitch">
            Need to create an account?
          </div>
        </form>

        <!-- Forgot password link -->
        <div style="text-align: center; margin-top: 10px">
          <button
            id="forgotPasswordLink"
            style="
              background: none;
              border: none;
              color: var(--accent-2);
              cursor: pointer;
              font-weight: 700;
            "
          >
            Forgot password?
          </button>
        </div>
      </div>
    </div>

    <!-- Password reset UI -->
    <div class="auth-container" id="resetContainer" style="display: none">
      <div class="auth-box">
        <div class="auth-title">Reset your password</div>
        <p style="color: var(--muted); text-align: center; margin: 8px 0">
          Enter the email address for your account — we'll send a link to reset
          your password.
        </p>
        <div class="auth-error" id="resetError"></div>

        <div
          style="
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 12px;
          "
        >
          <input
            id="resetEmailInput"
            class="auth-input"
            placeholder="Email"
            type="email"
          />
          <button class="auth-button" id="sendResetBtn">
            Send reset email
          </button>
          <button
            class="auth-button"
            id="backToAuthFromReset"
            style="
              background: transparent;
              color: var(--accent-2);
              border: 1px solid rgba(255, 255, 255, 0.03);
            "
          >
            Back
          </button>
        </div>

        <p
          style="
            color: var(--muted);
            font-size: 0.9rem;
            text-align: center;
            margin-top: 12px;
          "
        >
          If you don't receive the email, check your spam folder or try again.
        </p>
      </div>
    </div>

    <!-- Verification container: shown when a user is signed in but not verified -->
    <div class="auth-container" id="verifyContainer" style="display: none">
      <div class="auth-box">
        <div class="auth-title">Verify your email</div>
        <p style="color: #cfeede; text-align: center; margin: 8px 0">
          We've sent a verification link to
          <strong id="verifyEmail"></strong>
        </p>
        <div class="auth-error" id="verifyError"></div>

        <div
          style="
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 12px;
          "
        >
          <button class="auth-button" id="resendVerificationBtn">
            Resend verification email
          </button>
          <button class="auth-button" id="checkVerificationBtn">
            I've verified — Check now
          </button>
        </div>

        <div
          style="
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 12px;
          "
        >
          <button
            class="auth-button"
            id="signoutFromVerify"
            style="
              background: transparent;
              color: var(--accent-2);
              border: 1px solid rgba(255, 255, 255, 0.03);
            "
          >
            Sign out
          </button>
        </div>

        <p
          style="
            color: var(--muted);
            font-size: 0.9rem;
            text-align: center;
            margin-top: 12px;
          "
        >
          If you don't see the email, check your spam/junk folder or try
          resending.
        </p>
      </div>
    </div>

    <div class="sidebar">
      <h2>Questions</h2>
      <div class="question-list" id="questionList">
        <!-- Question numbers will be inserted here by JavaScript -->
      </div>
    </div>

    <div class="main-content">
      <div class="assignment-selector">
        <div class="dropdown-container">
          <label for="chapterSelect">Chap:</label>
          <select id="chapterSelect"></select>
        </div>
        <div class="dropdown-container">
          <label for="assignmentSelect">Asgn:</label>
          <select id="assignmentSelect"></select>
        </div>
      </div>

      <div class="question-container">
        <div class="question-header">
          <h2 id="currentQuestion">Select an assignment to begin</h2>
          <button id="loadLastQuestionBtn">Load Answer Key</button>
          <div id="questionTimer"></div>
        </div>
        <div id="questionContent">
          <img
            id="questionImage"
            class="question-image"
            src=""
            alt="Question image"
            style="display: none"
            data-action="zoom"
          />
          <div
            id="imageLoader"
            class="image-loader"
            style="display: none"
            aria-hidden="true"
          >
            <div class="spinner" aria-hidden="true"></div>
          </div>
        </div>

        <div class="navigation" style="display: none">
          <button id="prevButton" class="nav-button" disabled>Previous</button>
          <div class="mark-options" id="markOptions" style="display: none">
            <!-- Buttons here will be inserted by js -->
          </div>
          <button id="nextButton" class="nav-button" disabled>Next</button>
        </div>

        <div class="notes-container" style="display: none">
          <h3 style="margin-bottom: 0px">Notes</h3>
          <textarea
            id="notesArea"
            class="notes-area"
            placeholder="Write your notes here..."
          ></textarea>
          <button id="saveNotesBtn">Save Notes</button>
        </div>
      </div>
    </div>

    <script src="image-zoom/zoom-vanilla.js"></script>
    <script src="script.js"></script>
  </body>
</html>
